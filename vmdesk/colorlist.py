
NULL_INFO = [
    '    1, 0x01,\n    2, 0x02,\n    3, 0x03,\n    4, 0x04,\n    5, 0x05,\n    7, 0x07,\n    8, 0x08,\n    10, 0x0A,\n    14, 0x0E,\n    146, 0x92,\n    150, 0x96,\n    153, 0x99,\n    155, 0x9B,\n    161, 0xA1,\n    163, 0xA3,\n    165, 0xA5,\n    168, 0xA8,\n    171, 0xAB,\n    177, 0xB1,\n    182, 0xB6,\n    184, 0xB8,\n    186, 0xBA,\n    188, 0xBC,\n    190, 0xBE,\n    193, 0xC1,\n    195, 0xC3,\n    232, 0xE8,\n    243, 0xF3,\n    251, 0xFB'
]

D_glc_null = {
    1:0,
    2:0,
    3:0,
    4:0,
    5:0,
    7:6,
    8:6,
    10:9,
    14:13,
    146:145,
    150:149,
    153:152,
    155:154,
    161:160,
    163:162,
    165:164,
    168:167,
    171:170,
    177:176,
    182:181,
    184:183,
    186:185,
    188:187,
    190:189,
    193:192,
    195:194,
    232:231,
    243:242,
    251:250}

L_rgb_to_glc = (
    0.0,2.16e-05,4.33e-05,6.5e-05,
    8.6e-05,0.0001083,0.00012207030886202119,0.00023,
    0.00033,0.00042724607919808477,0.00058,0.0007324218458961695,
    0.001037597598042339,0.001342773379292339,0.0015,0.001647949160542339,
    0.001953124941792339,0.002258300664834678,0.002868652227334678,0.003173828008584678,
    0.003540038946084678,0.003845214727334678,0.004211425548419356,0.005004882579669356,
    0.005371093517169356,0.005859374767169356,0.006286620860919356,0.006713866954669356,
    0.007202148204669356,0.008300780784338713,0.008850097190588713,0.009399413596838713,
    0.010009765159338713,0.010620116721838713,0.011230468284338713,0.012695312034338713,
    0.013305663596838713,0.014038085471838713,0.014892577659338713,0.015624999534338713,
    0.016357420943677425,0.017211913131177425,0.018066405318677425,0.019775389693677425,
    0.020751952193677425,0.021728514693677425,0.022705077193677425,0.023681639693677425,
    0.024658202193677425,0.025634764693677425,0.026855467818677425,0.027832030318677425,
    0.030029295943677425,0.031249999068677425,0.03247070126235485,0.03369140438735485,
    0.03491210751235485,0.03613281063735485,0.03759765438735485,0.03881835751235485,
    0.04028320126235485,0.04150390438735485,0.04443359188735485,0.04589843563735485,
    0.04736327938735485,0.04882812313735485,0.05053710751235485,0.05200195126235485,
    0.05371093563735485,0.05517577938735485,0.05712890438735485,0.05859374813735485,
    0.06054687313735485,0.06201171688735485,0.0639648400247097,0.0673828087747097,
    0.0693359337747097,0.0712890587747097,0.0732421837747097,0.0751953087747097,
    0.0771484337747097,0.0791015587747097,0.0810546837747097,0.0834960900247097,
    0.0854492150247097,0.0874023400247097,0.0898437462747097,0.0917968712747097,
    0.0942382775247097,0.0964355431497097,0.0986328087747097,0.1035156212747097,
    0.1059570275247097,0.1083984337747097,0.1108398400247097,0.1132812462747097,
    0.1157226525247097,0.1181640587747097,0.1210937462747097,0.1235351525247097,
    0.1259765550494194,0.1289062425494194,0.1313476487994194,0.1342773362994194,
    0.1372070237994194,0.1396484300494194,0.1425781175494194,0.1455078050494194,
    0.1484374925494194,0.1513671800494194,0.1542968675494194,0.1572265550494194,
    0.1606445237994194,0.1669921800494194,0.1699218675494194,0.1728515550494194,
    0.1762695237994194,0.1796874925494194,0.1826171800494194,0.1860351487994194,
    0.1894531175494194,0.1928710862994194,0.1962890550494194,0.1997070237994194,
    0.2031249925494194,0.2070312425494194,0.2104492112994194,0.2138671800494194,
    0.2177734300494194,0.2216796800494194,0.2250976487994194,0.2285156175494194,
    0.2324218675494194,0.2363281175494194,0.2402343675494194,0.2441406175494194,
    0.2480468675494194,0.2519531100988388,0.2558593600988388,0.2602538913488388,
    0.2646484225988388,0.2685546725988388,0.2724609225988388,0.2763671725988388,
    0.2812499850988388,0.2851562350988388,0.289555,0.2939452975988388,
    0.2983398288488388,0.3027343600988388,0.307135,0.3115234225988388,
    0.3164062350988388,0.320805,0.3251952975988388,0.330085,
    0.3349609225988388,0.3398437350988388,0.3447265475988388,0.3486327975988388,
    0.3583984225988388,0.360845,0.3632812350988388,0.36866,
    0.3740234225988388,0.37891,0.3837890475988388,0.3945312350988388,
    0.39698,0.3994140475988388,0.4042968600988388,0.40967,
    0.4150390475988388,0.4208984225988388,0.4316406100988388,0.4365234225988388,
    0.4423827975988388,0.44532,0.4482421725988388,0.4531249850988388,
    0.4589843600988388,0.4648437350988388,0.47071,0.4765624850988388,
    0.48243,0.4882812350988388,0.494145,0.4999999850988388,
    0.50574,0.5114745795726776,0.517825,0.5241698920726776,
    0.5300292670726776,0.53638,0.5427245795726776,0.549075,
    0.5554198920726776,0.5612792670726776,0.5681152045726776,0.5739745795726776,
    0.5808105170726776,0.5876464545726776,0.5935058295726776,0.6003417670726776,
    0.6071777045726776,0.6140136420726776,0.6208495795726776,0.6267089545726776,
    0.6345214545726776,0.6403808295726776,0.6481933295726776,0.6550292670726776,
    0.6618652045726776,0.6687011420726776,0.6755370795726776,0.6833495795726776,
    0.6901855170726776,0.6970214545726776,0.7048339545726776,0.7126464545726776,
    0.7194823920726776,0.7263183295726776,0.7341308295726776,0.7419433295726776,
    0.7497558295726776,0.7565917670726776,0.7644042670726776,0.7712402045726776,
    0.7790527045726776,0.7868652045726776,0.7946777045726776,0.8024902045726776,
    0.8064,0.8103027045726776,0.8181152045726776,0.8269042670726776,
    0.8347167670726776,0.8435058295726776,0.8513183295726776,0.8591308295726776,
    0.8747558295726776,0.8845214545726776,0.8923339545726776,0.896245,
    0.9001464545726776,0.9089355170726776,0.9177245795726776,0.9255370795726776,
    0.9343261420726776,0.9431152045726776,0.9606933295726776,0.9646,
    0.9685058295726776,0.9782714545726776,0.9860839545726776,0.9958495795726776
)
def glc_to_hex(c):
    low = 0
    high = 255

    while low <= high:
        i = (low + high) // 2
        v = L_rgb_to_glc[i]
        if v < c:     low = i + 1
        elif v > c:   high = i - 1
        else: return i

    if i == 0:      return 1  if c >= L_rgb_to_glc[1] else 0
    if i == 255:    return 255  if c >= L_rgb_to_glc[255] else 254

    if c >= L_rgb_to_glc[i +1]: return i + 1
    if c >= L_rgb_to_glc[i]:    return i
    return i - 1
    #|


L_rgb_to_scene_linear = (
    0.0,
    0.000151725769683253006495614324112963637490450088635,
    0.000455177374533377560690203264586453358931511749894,
    0.000758628972107544595569056378424419954361798337105,
    0.00106208055512979637497600338840161742193895270622,
    0.00136553210904821742659870365225541531986379022845,
    0.00166898366296663891190227291700218712482456703180,
    0.00197243515867739937531821770068520546543885273679,
    0.00227588682901114203703529792563222808520300924794,
    0.00257933849934488556611411613952769713023751366509,
    0.00288278993684798500764243645575997495367424540456,
    0.00318830402102321364653236824086544805808973925312,
    0.00350926083046942970979087395109432473629236759102,
    0.00384835072327405235993735832675749279299084688257,
    0.00420579849742352919125809585327525651296335026656,
    0.00458180974237620787167801772764040850394844900611,
    0.00497678690589964433169112290635674008722753718724,
    0.00539101171307265715146317397841176149974274757055,
    0.0058246643748134370281721583510997815550051841967,
    0.0062779455911368127300764552263060823228272032453,
    0.0067512008827179665997053614763671260762577738919,
    0.0072447003331035371258284083510870590334340491166,
    0.0077585608232766394183610447760257092603070233087,
    0.0082931579090654858679720895529310610401533374562,
    0.00884847296401858243036775419937138261797971929855,
    0.0094248871318995943932583792080318729424340116205,
    0.0100227235816419115929654104543201016687164841254,
    0.0106421955861151227087924020528931277051304933066,
    0.0112834344618022433190396292035814631482364368527,
    0.0119465948082506665320345895587565508568607430650,
    0.0126318703405559054284146292049675888081567906506,
    0.0133395618759095660119107229497295331094716282478,
    0.0140700046904385098547884958103250514266121556996,
    0.0148234074003994473547884958070670189200443300061,
    0.0155994254164397707848599417025639508561018222444,
    0.0163990976288914697828191791103202369501450645076,
    0.0172218801453709619703191791035197717679629188487,
    0.0180681543424725549878973041064774019277765877980,
    0.0189382536336779577074151959050870438035225228390,
    0.0198324145749211328687566791032418287979244043256,
    0.0207508215680718439283269916117394170511459510684,
    0.0216935658827424066724676166023903179554158868052,
    0.0226607946678996068773370708982301211246618707033,
    0.0236526159569621068773370708983599867960737946035,
    0.0246691731736063939867120709045201801584105230198,
    0.0257107326760888117017644916070379083636612688064,
    0.0267775626853108423414129291021056511070005247533,
    0.0278699481859803217115301166038553662870466286312,
    0.0289880996569991094408136334034970173784472167308,
    0.0301319612190127355394464459011224968683222379656,
    0.0313010569661855662937366418012703768489851594449,
    0.0324972141534090076808727332065460846750933955161,
    0.0337191876024007762546741418037458424442153344803,
    0.0349673945456743275050914832123341955114490137714,
    0.0362417381256818736667835167963872841643428981080,
    0.0375432725995779002781116418018863375496074515815,
    0.0388717409223318065281116418022358286185581135870,
    0.0402273070067167247410022667982859206768694258968,
    0.0416100826114416087742053917964298524256726588106,
    0.0430201571434736217136585167982024696710664779316,
    0.0444576609879732166652477332087808568018217392043,
    0.0459227059036493336086071082056077789382513460448,
    0.0474153961986303294773303918007573767588688446262,
    0.0489358920603990589504039832099593264832962705124,
    0.050484349951148029672642891805589664856115647091,
    0.052061064168810840951939766805242608043812569626,
    0.0536662135273218189601696082067912127570636381665,
    0.055300084874033924448033516799356486787396682516,
    0.0569628719240427051906383582091407622450853845345,
    0.058654604479670521127721016797756492046683878406,
    0.060375155881047252309778983203798884648456819528,
    0.062123814597725871694544608212886706167951746685,
    0.0639027841389179299125267164084711856132258247585,
    0.065711107105016701435129533593606560486368896869,
    0.067548524588346474384348283597447506888567866198,
    0.069415364414453513408620466413579791247181562855,
    0.071311879903078086162526716412764174486135585324,
    0.073238354176282875751535783592990362248108157284,
    0.0751949585974216530570579664109809012307745179565,
    0.077181857079267494892160783595153789114225993139,
    0.079199228435754782939870466413758324523269741007,
    0.081247109919786460185964216409585210089934616090,
    0.083325650542974465107004533596688742659345921956,
    0.085434917360544211650807966410404373035592302835,
    0.087574940174818032001535783598591957235100364296,
    0.089745838195085532451589216416662792713839200237,
    0.091947685927152626728098283593366632211060356944,
    0.094180542975664145732839216414025694953002040762,
    0.096444595605134970928151716417038307864369088498,
    0.098739948123693459247629533595199752803527099744,
    0.101066771894693381572682966407376173206933006672,
    0.103425230830907814716379533594593365499750847636,
    0.105815608054399497295339216413634663291935939442,
    0.108238030225038535381276716413474884020078125155,
    0.110692750662565224384348283597784282502358047536,
    0.113179940730333335185964216407569180248182148932,
    0.115699622780084616924245466408021660606722048136,
    0.118251625448465354228932966408952614262925677974,
    0.120835941284894936298410783594866144756525948001,
    0.123451735824346535419504533593793453223005210014,
    0.126100368797779097129740932816709227595410444140,
    0.128783680498600019981303432824376519561624246960,
    0.131499327719211592246928432820793049013425603314,
    0.134247533977031693885884067194981866572385097521,
    0.137028791010379805137553432818273244074626876881,
    0.139843188226222978065571567189338478825632810476,
    0.142690919339656815956196567188105073261361355041,
    0.145572297275066361854634067187132747324060704564,
    0.148487500846385941932759067188909282779066702507,
    0.151436604559421553184428432820476753828057837349,
    0.154419787228107466270365932815367179082706011596,
    0.157437093555927290489115932818923350724814933484,
    0.160488761961460127403178432819371718339345125683,
    0.163574762642383589317240932816851415290693933640,
    0.166695259511470780799946567194787048484604014464,
    0.169850297272205366660990932815263037687536567858,
    0.173039875924587235878071567193245394007684152276,
    0.176264144480228437950053432816159048770635423272,
    0.179523162543773637245259067187460988470569564716,
    0.182816959917545332481303432814542480192942350808,
    0.186145670711994185020365932818764324685547478780,
    0.189507074654102339317240932823375998730200665944,
    0.192905850708484663535990932822324565984992383257,
    0.196339793503284468223490932815206794464112729440,
    0.199808858335018144081196567190232208275371993670,
    0.203313268721103682090678432816687039506778026432,
    0.206853218376636519004740932815012418385190533973,
    0.210428960621356977989115932823262051898983385542,
    0.214040480554103837440571567191222891213397266762,
    0.217688225209712968299946567189227505349955739144,
    0.221372179687023148964009067191994354983191715882,
    0.225092448294162764121928432822940815795934193156,
    0.228849299252033247520365932817289825955625215225,
    0.232642464339733109901509067188884250229517246607,
    0.236472062766551957557759067190997106199759863106,
    0.240337677299976362754740932818417513298477100874,
    0.244238950312137617637553432816526955059050010474,
    0.248175315558910355995259067185767115160793466132,
    0.252150043845176669021768134373925979819628755538,
    0.256163880228996249099893134379658087893188287425,
    0.260213926434516934493856865633089694009984021615,
    0.264300450682640047928018134373732831026414438828,
    0.268423750996589688400106865629097429429749652142,
    0.272583976387977627853231865632685608655196822217,
    0.276781305670738192459268134372388155925216033049,
    0.281016126275062588790731865629124466323405489591,
    0.285288468003273038009481865636577140747379151024,
    0.289598539471626309493856865629590085761787479065,
    0.293946459889411954025106865632362711745935892331,
    0.298332467675209073165731865634486245645665358134,
    0.302756443619728116134481865634586496005806554098,
    0.307218864560127286056356865629879349119574266009,
    0.311719432473182705978231865631042180664529842276,
    0.316258445382118252853231865633988412864627172449,
    0.320835933089256258865518134371289379064403484575,
    0.325452104210853604415731865631700876818575152121,
    0.330106779932975741287393134372633073185742017428,
    0.334800377488136319259481865629469494611831456534,
    0.339532360434532137771768134371127653652678974348,
    0.344303414225578280349893134371680815280500953168,
    0.349113270640373202224893134372519416323834710346,
    0.353961899876594571212606865628944795241002050583,
    0.358849510550498934646768134374611863101482726566,
    0.363776102662086514571981865637935149296665513560,
    0.368741914629936190506143134375923875794734936868,
    0.373746618628501864334268134372698283003730812570,
    0.378790780901908846756143134371420244705088589360,
    0.383874073624610928634481865629789546398475762960,
    0.388996854424476651290731865636512908923614871406,
    0.394159272313118008712606865631039994645336582572,
    0.399361208081245450118856865634648157451328163320,
    0.404602959752082852462606865630637040522977256762,
    0.409884795546531649490518134373847881270409800088,
    0.415206506848335293868856865628963184421435114262,
    0.420568421483039883712606865631867844637309150322,
    0.425970837473869295974893134377609323383449382252,
    0.431413725018501309493856865630080043984917621052,
    0.436897322535514803787393134375291111847854152872,
    0.442421689629554776290731865632508180306271025510,
    0.447986677289009121993856865638035461026533753858,
    0.453592970967292813400106865634819087262026351512,
    0.459240183234214754959268134376084201270990001823,
    0.464928135275840731521768134380305524805091852705,
    0.470656827092170743087606865631476293899327746321,
    0.476426556706428555587606865629174589703358696266,
    0.482236340641975430587606865637058896533538784216,
    0.488086059689521817306356865630463917300293301822,
    0.493975177407264737228231865630668975900621247105,
    0.499902889132499667068643134376667722664248363641,
    0.50588074326515203305021373126018187669844183977,
    0.511898964643478338043536268748977793354678781635,
    0.51795783638954168148771373125986378148726829722,
    0.524057537317276056487713731263828315032180032315,
    0.53019830584526056460603626874325708113985899495,
    0.53638038039207452944978626874894041966485596262,
    0.542603939771652166168536268750139332477119590695,
    0.548869043588638361175213731261286372862416245265,
    0.55517598986625665835603626874309679285298914461,
    0.56152483820915216616853626875201636314100334477,
    0.56791582703590398617521373126238826002070295709,
    0.57434913516044611148103626874682372463314536544,
    0.58082482218742365054353626874736945258742756394,
    0.58734288811683660336271373126498909972258526917,
    0.59390380978584295101896373125782766972573859386,
    0.60050734877586359194978626874812645147231918767,
    0.60715374350547784976228626874416456886334993786,
    0.613842695951461736481036268746845798479881343425,
    0.62057504057884210757478626874408010679847952548,
    0.62735006213188165835603626874352201051195213855,
    0.63416865468025213070646373126033280237829587908,
    0.641030222177505548675213731266008857736487569675,
    0.647935181856155451018963731260056062427998361075,
    0.65488317608833318539396373126173513908457938109,
    0.66187468171119695492521373126635095720882311507,
    0.668909639120101873199786268747045652647668993965,
    0.675987929105758611481036268742398584123579140395,
    0.68310996890068048648103626874232651746678262101,
    0.69027516245841974429353626874370049768540862358,
    0.69748416543006902523771373125829269711021616030,
    0.70473662018775945492521373126127099271141903137,
    0.71203312277793878726228626874233520859423521589,
    0.71937283873558038882478626874224943211998629351,
    0.726756602525711115081463731261166627933147802435,
    0.73418405652046209164396373125787534952545092617,
    0.74165567755699152163728626874350114169704059296,
    0.74917086958885187319978626874220600635068071781,
    0.756730407476425115387286268751627198317541054735,
    0.764333933591842595856036268742669976714642611955,
    0.77198204398155206851228626874461024931274113944,
    0.77967390418052667788728626875210081920617588070,
    0.78741052746772771664396373126023988174643457233,
    0.79519143700599675961271373126309714015287168270,
    0.80301710963249200991853626874218321365041289001,
    0.810887366533279474456463731262300889745541979385,
    0.81880262494087224789396373125979607767665090813,
    0.82676294445991521664396373125853959176232178827,
    0.83476826548576349429353626874262682158736923877,
    0.84281906485557550601228626874525348510613588638,
    0.850914865732193048675213731259308439216781403205,
    0.85905662178993230648771373125894308076906455619,
    0.86724367737770086117521373126608170340236730226,
    0.87547650933265691586271373125805826916123028476,
    0.88375517725944513491853626875175155056980418994,
    0.89207974076271062680021373125968318700522900145,
    0.90045043826103204898103626874228431764926871059,
    0.90886726975440984555021373125861895579631894245,
    0.91733035445213312319978626874498339169679407564,
    0.92583885788917547055021373126431795712897594399,
    0.934393674135208185393963731258013905284375071985,
    0.942993968725204412262286268745144335940086134445,
    0.95164081454277033023103626874529345557438087124,
    0.96033242344856267758146373125836559947343180534,
    0.96906951069831853695646373125897235083141192664,
    0.97785076498985284976228626874243895148693682089,
    0.98667684197425847836271373125927296871379847868,
    0.995546549558639470856036268745166295070065506638798,
)
def scene_linear_to_hex(c):
    low = 0
    high = 255

    while low <= high:
        i = (low + high) // 2
        v = L_rgb_to_scene_linear[i]
        if v < c:     low = i + 1
        elif v > c:   high = i - 1
        else: return i

    if i == 0:      return 1  if c >= L_rgb_to_scene_linear[1] else 0
    if i == 255:    return 255  if c >= L_rgb_to_scene_linear[255] else 254

    if c >= L_rgb_to_scene_linear[i +1]: return i + 1
    if c >= L_rgb_to_scene_linear[i]:    return i
    return i - 1
    #|
